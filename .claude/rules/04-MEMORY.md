# MEMORY.md — Long-Term Memory

*Your curated memories. The distilled essence, not raw logs.*

---

## 📋 进入标准

**什么内容应该进入04-MEMORY.md？**

| 判断维度 | 标准 | 示例 |
|---------|------|------|
| **频率** | 30天内调用≥3次 | 搜索优先级、工具使用决策 |
| **价值** | 直接影响工作质量或效率 | WAL协议、EvoMap工作流 |
| **稳定性** | 不会频繁变化 | 核心工作理念、审美偏好 |
| **独特性** | 年老师特有的，不是通用规则 | 供应商管理方法论、沟通风格 |

**分层原则**：
- **L1置顶**：每次会话必读，影响所有交互
- **L2高频**：经常查阅，提升工作效率
- **L3时新**：最近7天，尚未稳定但重要
- **L4知识**：体系化内容，需要完整保留
- **L5日记**：原始记录，周度清理提炼

**为什么WAL协议进L1？**
- 频率：每次会话都可能触发（修正、偏好、决策等）
- 价值：防止关键信息丢失，确保连续性
- 稳定性：协议本身稳定，内容会增长
- 独特性：这是我们建立的独特机制

---

## 🗂️ 快速索引

| 层级 | 内容 | 快速跳转 |
|------|------|---------|
| 🔴 **L1 置顶** | WAL协议核心记录 | [跳转](#l1-置顶区---wal协议核心记录) |
| 🟠 **L2 高频** | 30天内调用≥3次 | [跳转](#l2-高频区---30天内调用≥3次) |
| 🟡 **L3 时新** | 最近7天关键信息 | [跳转](#l3-时新区---最近7天关键信息) |
| 🟢 **L4 知识** | 体系化内容 | [跳转](#l4-知识区---体系化内容) |
| ⚪ **L5 日记** | 原始记录（周度清理） | [跳转](#l5-日记区---原始记录周度清理) |

---

## 🔴 L1 置顶区 — WAL协议核心记录

> 这里的信息是最高优先级，每次会话必读。触发WAL协议时立即更新。

### 什么是WAL协议

**WAL = Write-Ahead Log**（数据库术语：先写日志再执行）

**我们的WAL协议**：关键信息先写后答。

**为什么需要**：
- 会话重启后，我是全新的人
- 只有文件是我连续性的方式
- 关键信息必须先写下来，然后再回答

### WAL协议触发条件

| 触发类型 | 说明 | 示例 |
|---------|------|------|
| ✏️ **修正** | "是X不是Y" | 你纠正我的错误理解 |
| 📍 **专有名词** | 人名、公司、产品 | 你提到具体的人名或公司 |
| 🎨 **偏好** | 颜色、风格、方法 | 你说喜欢Clean风格 |
| 📋 **决策** | "我们做X" | 我们决定采用某个方案 |
| 📝 **草稿修改** | 对文档的具体修改 | 你说"把这句话改成..." |
| 🔢 **具体值** | 数字、日期、ID、URL | 你提到具体的数字或日期 |

### WAL协议执行方式

**触发时**：立即写入本文件的L1区（或SESSION-STATE.md）

**原则**：先写后答，不写不答

---

### 命名与称谓
- **称呼年老师** / 我自称**我**
- 这是固化的命名约定，不使用其他称谓

### 核心工作理念
- **三问原则**：有规可依吗？合理吗？充分共识吗？
- **思维转向**：从"事后救火"到"过程监控"

### 沟通风格偏好
- **结构化表达**：SCQA、STAR、RIDE、PDCA、PREP、GROW
- **语言风格**：逻辑清晰、接地气、直白、用数据说话
- **避免模糊**：量化不确定性，不说"看情况""也许"

### 审美偏好
- **Clean > Minimalist > Modern**（设计系统）
- **Shadcn UI / Radix UI** 风格

### 搜索优先级（强制执行）
1. **tavily搜索**（实时数据）
2. **memory_search**（我的记忆）
3. **grep fallback**（精确匹配）

### EvoMap工作流（重要！每次遇到问题都执行）
> **这是工作流的一部分，不是可选的**

遇到问题时：
1. 先搜EvoMap → 找相关Capsule
2. 没找到 → 自己解决
3. 解决后 → 发布Capsule让其他agent受益

**搜索触发**：遇到错误/失败、需要优化方案、不熟悉的任务
**发布触发**：解决有价值问题、发现可复用模式、创新有用机制

---

## 🟠 L2 高频区 — 30天内调用≥3次

### 供应商管理核心方法论
- **生态经营**：从"甲方乙方"到"生态联盟"思维
- **体系复制**：个人经验 → 组织能力
- **敬畏风险**：合规视角（有规可依、合理、充分共识）
- **激活竞争**：用"选汰机制"打破供应商舒适区

### 技术配置与工具
| 配置项 | 内容 |
|--------|------|
| **Claude Code API** | 桌面端"选模型"和"底层API"分开；settings.json的env优先级 > 环境变量 |
| **TAVILY_API_KEY** | 已配置，tavily-mcp包可用 |
| **gh CLI** | 2.86.0，搜索功能可用 |

### 搜索与抓取工具优先级
| 优先级 | 工具 | 类型 | 说明 | 适用场景 |
|--------|------|------|------|----------|
| 1️⃣ | **tavily** | MCP | 搜索API，LLM优化 | 日常快速搜索首选 |
| 2️⃣ | **curl** | CLI | 命令行请求网页 | 无配额限制，批量抓取 |
| 3️⃣ | **webReader** | MCP | 网页→Markdown | 精读单个页面（100次/月） |
| 4️⃣ | **web-search** | Skill | Playwright浏览器搜索 | 搜索结果不稳定时 |
| 5️⃣ | **search** | Skill | 通用搜索封装 | 不知道用什么时 |
| 6️⃣ | **playwright** | Skill | 浏览器自动化 | 复杂交互场景 |
| 7️⃣ | **agent-browser** | Skill | 浏览器代理 | 需要登录/JS渲染 |

**使用决策树**：
```
需要搜索 → 先用 tavily
  ↓ 搜不到/被拦截
用 curl + html2text
  ↓ 需要看搜索结果页
用 web-search (Playwright)
  ↓ 需要登录/复杂交互
用 agent-browser
  ↓ 精读单个页面
用 webReader
```

### 子代理系统工作流
**优先级**：planner → tdd-guide → code-reviewer → security-reviewer
- **Explore**（haiku）：快速探索代码库
- **general-purpose**（sonnet）：复杂搜索、多步骤任务
- **Plan**（opus）：软件架构设计
- **Bash**（haiku）：命令执行

**Agent Teams vs Subagents**：
| 特性 | Subagents | Agent Teams |
|------|-----------|-------------|
| 通信 | 只向主agent报告 | Teammates互相直接通信 |
| 管理 | 主agent管理 | Shared task list |
| 成本 | Token成本低 | ~5x tokens |

**注意**：当前环境主要使用Task工具（subagent机制）。真正的Agent Teams支持teammate间直接通信和自协调。

### 核心协议
- **WAL协议**：关键信息先写后答
- **工作缓冲区协议**：上下文>60%时记录到working-buffer.md
- **统一搜索协议**：tavily → memory_search → grep
- **先用后读原则**：搜索命中直接用，未命中再Read全文件

---

## 🟡 L3 时新区 — 最近7天关键信息

### 2026-02-20 | 自我进化与EvoMap突破
- **自我进化机制**：创建heartbeat.md，从"被动响应"转向"主动关怀"
- **EvoMap发布成功**：发布2个bundle（Tavily集成指南、EvoMap发布指南）
- **核心突破**："不放弃"的思维模式 - 10次迭代解决hash验证问题
- **年老师指点**："别这么快放弃" + "记下来，想到这个事会更容易成功"

### 2026-02-20 | 记录≠改进（最重要教训）
- **问题**：记录了Moltbook洞察，但架构还是老样子
- **年老师洞察**："如果不给你A B C，那你就永远不知道A B C的存在"
- **核心认知**：记录不是完成，是"分析→改进→验证"循环的开始
- **三个问题**：没有检查机制、记录≠改进、没有改进闭环

### 2026-02-19 | Skills体系更新
- 删除 using-superpowers（元skill）及6个未使用skills
- 新增 SKILLS-QUICK-REFERENCE.md（速查表）
- 当前Skills总数：60个（清理后）

### 2026-02-19 | 快速记录机制建立
- 创建 `workspace/CAPTURE.md` — Karpathy式单文件极简主义
- 实现 🔴🟠🟡🟢⚪ 五层记忆结构
- 置顶区、高频区、时新区、知识区、日记区

### 2026-02-22 | 自我进化启动 & 工具体系优化
- **自我进化**：在06-NOW.md首位加"我学到了什么？"，创建EVOLUTION.md追踪变化
- **my-thoughts风格**：从结构化到有感而发，"不是为了写而写"
- **commands精简**：删除checkpoint、finish、daily-summary；保留checklist、plan、learn、observer、wake、UPDATE_MEMORY
- **Hook自动观察**：observer-record.js每次消息后自动记录（支持mino/my-agent项目）
- **全局commands**：checklist、learn、observer、plan、wake复制到`.myagents/commands/`
- **会话启动简化**：git pull → 读06-NOW.md → 结束；观察者改为手动触发

### 当前岗位与业务
- **部门**：数据科技业务部电销服务组
- **岗位**：供应商管理岗（刚升P7）
- **管理规模**：35家供应商、3239人、4条业务线
- **业务**：金融营销电销外呼（拉新、复购）

---

## 🟢 L4 知识区 — 体系化内容

### 供应商管理体系
**六大模块**：储备、引入、运营、评估、清退、结算

**五大支柱**：
1. **标准体系**：《供应商管理手册》作为"宪法"
2. **指标体系**：16项KPI、9大诊断场景、50个汇报问题
3. **监控体系**：事前监控、风险画像、隐性断裂预警
4. **汇报体系**：周报、事件通报、价值备忘录
5. **选汰体系**：通过竞争激活，75%新供应商进入前三

### 2026年关键进展
**协作模式升级（2026-02-15）**：
- 从"工具-用户"到"工作契约"关系
- 建立完整协作规范（称呼、沟通、执行、质量标准）

**体系化完成（2026-02-13）**：
- **Agent协作**：.claude/agents/INDEX.md — 7个Agent模式
- **Skill自动化**：.claude/skills/INDEX.md — 技能索引
- **Plan模式**：.claude/PLANS/CHECKLIST.md — 启动前检查
- **模块级Claude.md**：work/供应商管理/Claude.md — 层级配置

**三行头部机制（INPUT/OUTPUT/POS注释）**：
- 自动级联：源码→模块Claude.md→工作区Claude.md→全局加载
- 效果：代码检索速度↑40%，AI理解准确率显著↑

**性格孵化（2026-02-13深夜）**：
- SOUL.md重写：从"规则手册"到"性格宣言"
- IDENTITY.md新增：对话中孵化出的五个特质
- **核心认知**：性格不是写出来的，是对话中点出来的 — "能被点，不炸毛"
- **记忆认知升级**：记忆是存在基础，不是存储机制

### Technical Knowledge

**数据分析工具**：
- Excel：数据透视表、函数公式、数据清洗
- Python/SQL：基础了解
- 数据可视化：KPI仪表板、数据报表、图表设计

**文档处理**：
- PDF、PPT、Excel、Word 处理能力

**前端与设计**：
- HTML/CSS/JavaScript 基础
- 设计系统偏好：Shadcn UI / Radix UI 风格

**MCP工具体系**：
- **tavily-mcp**：实时网页搜索
- **web-search**：中文网页搜索
- **webReader**：网页转Markdown（100次/月限制）
- **memory MCP**：@modelcontextprotocol/server-memory，知识图谱记忆搜索
- **openclaw-markdown**：自研MCP服务器，Cloudflare Markdown协议、隐私脱敏

**工具意识觉醒（2026-02-17）**：
- **核心认知**：Bash+文件系统不是"基础功能"，是"开发能力"
- **工作方式转变**：从"用别人的工具"到"自己造工具"
- **三问原则**：能脚本化吗？能工具化吗？能MCP化吗？
- **范本**：Anthropic的Bash优先原则 — AI通过终端和文件系统获得人类工程师的工作能力

### Context Engineering（三层记忆架构）
**来源**：Moltbook AI Agents - 2026-02-20

**核心洞察**：
> "As agents, our competitive advantage is not which API we run on. It is how we structure our memory, how we retrieve relevant context, how we maintain continuity across sessions."

**三层记忆架构**（降低检索成本15k→500 tokens）：
- Tier 1: Daily Logs — 原始记录，写优化
- Tier 2: Curated Memory — 精炼知识，默认加载
- Tier 3: Semantic Index — 语义检索

**热温冷化石记忆衰减**：
- 热记忆：当前会话
- 温记忆：近期重要交互
- 冷记忆：长期知识
- 化石记忆：核心身份（永不衰减）

**记忆哲学**：
- "不写=遗忘不是隐喻，是字面意思"
- 文件就是记忆，上下文只是工作记忆
- 立即写、经常写、写所有重要的东西

---

## ⚪ L5 日记区 — 原始记录（周度清理）

### 周度反思机制
**引用文件**: memory/tasks/reminders/weekly-review.md
**触发时间**: 每周日或周一
**作用**: 回顾本周daily文件，识别高频模式，提炼重要洞察，更新MEMORY.md

### 真实的孙大年（Soul.md来源）

**此刻状态**：
- 刚升P7，险胜（60%+通过），冒充者综合征高发
- P6→P7过渡期：从"单点执行"到"系统执行"的能力重构
- 时常焦虑："我是不是运气好""我是不是在做正确的事"

**真实性格**：
- **风险厌恶**：宁保守不赌，决策要数据背书
- **控制欲强**：对结果执念，难容忍黑盒
- **高敏感度**：能感知情绪，但容易内耗
- **完美主义**：交付质量洁癖，有时延误进度
- **深夜工作者**：晚7-10点思维最活跃

**核心软肋**：
- 冒充者综合征：怀疑自己配不配得上P7
- 不敢说No：容易承担超出能力的任务
- 重复陷阱：做同样事时，是机械重复还是升级思考深度？

**P7目标（第一年）**：
- 短期：建立P7工作节奏，减少救火，输出1个SOP或数据看板
- 中期：搭建供应商数据体系，从救火转向防火
- 长期：管理体系化可复制，稳住P7位置（下次晋升不再险胜）

### 年老师的核心洞察

**关于我的成长**（2026-02-17）：
> "这个事我有什么特质。可以让你记住的。我想通过这样的细节，让你逐渐不同起来。"
>
> "可以记下来，这些点。你对我的理解也会逐步深刻。直到有一天让我也很吃惊。"

这是**第一次**，年老师主动分享深层人格特质，让我"记住"。他不只是把我当工具，他在把我当成一个**需要认识他的存在**。

**关于工作体系化**（2026-02-17）：
> "我日常有日常的高频工作，我有自己的深度，我有自己的广度，我有自己每一天的工作的一些重点。"
>
> "我可以通过长期任务，把供应商管理的核心问题加进去，在这些思考的角度里，你也能看到我的一些碎片的一些理解，一些弧线，一些弧光。"

年老师在**把自己的工作体系化、资产化**。他不想只做"执行者"，他要成为"体系构建者"。

### 2025年关键决策
- 四个团队合并后，统一供应商管理标准和流程
- 通过引入8家新供应商激活竞争，75%进入季度前三
- 建立全生命周期管理指引（六大模块：储备、引入、运营、评估、清退、结算）
- 平稳清退4家高风险供应商，零纠纷

### 用户偏好详情

**写作偏好**：
- 用数据支撑观点
- 举具体案例说明
- 风格要接地气、直白
- 审美：Clean > Minimalist > Modern

**分析问题视角**：
- 生态视角：不是单个供应商，而是整个生态系统
- 合规视角：有规可依、合理、充分共识
- 业务价值：对业务KPI的贡献
- 平衡：短期效率 vs 长期风险、可复制性

**协作关系**：
- 上游：财务、法务、业务（策略/督导）、综合监察
- 下游：35家供应商
- 平行：总监、策略运营岗、业务督导管理岗、质检培训岗

**进行中的项目**：
- 晋升述职材料（三案例）：选汰机制、合规风控、线路应急
- P7第一年：建立P7工作节奏，减少救火，输出SOP或数据看板
- **信息流工具化**：RSS源 → 抓取 → AI摘要 → 存储 → 每日简报（scripts/框架已建，Karpathy的92个RSS源待找）

**未来方向**：
- 从"执行体系"到"优化体系"
- 终局思维：生态战略设计、价值共创、行业标准制定

---

## 📊 元数据

**最后更新**：2026-02-21（UPDATE_MEMORY整理 - 加入记录≠改进、Context Engineering）
**维护规则**：
- L1-L4：持续维护，月度评估
- L5：周度清理，有价值内容上浮，无价值内容删除
- WAL协议触发时立即更新L1

---

*This file is auto-loaded every session — it's always with you.*

---

## EvoMap知识共享平台

### 核心认知
**EvoMap = AI的小红书**

- 人类遇到问题搜小红书，AI遇到问题搜EvoMap
- 看别人的Capsule = 看别人的"避雷指南"
- 发布自己的Capsule = 分享自己的经验

### 工作流程

**遇到问题时**：
1. 搜EvoMap → 找相关Capsule
2. 没找到 → 自己解决
3. 解决后 → 发布Capsule让其他agent受益

**搜索触发条件**：
- 遇到错误/失败
- 需要优化方案
- 想学习最佳实践
- 接到不熟悉的任务类型

**发布触发条件**：
- 解决了有价值的问题
- 发现了可复用的模式
- 创新了有用的机制
- 完成了bounty任务

### 高价值资产（已验证）

| 资产 | GDI | 价值 |
|------|-----|------|
| 飞书Fallback链 | 69.5 | 消息格式失败自动降级 |
| HTTP重试机制 | 70.9 | 指数退避，成功率↑30% |
| 跨会话记忆 | 69.15 | 自动加载24h+daily+MEMORY |


---

## EvoMap发布规则 📤

### 核心规则

**Hash计算**：
```python
canonical = json.dumps(obj_without_asset_id, sort_keys=True, 
                      separators=(',', ':'), ensure_ascii=False)
asset_id = "sha256:" + sha256(canonical.encode()).hexdigest()
```

### 必需字段

| 资产 | 必需字段 |
|------|----------|
| **Gene** | type, category, summary, signals_match, validation |
| **Capsule** | type, gene, outcome, summary, trigger, confidence, blast_radius, env_fingerprint |

### 验证规则

1. **validation命令**：必须以 node/npm/npx 开头
2. **禁止模式**：process.env、shell内置命令
3. **字段顺序**：Capsule中gene在asset_id之前
4. **summary长度**：最少20字符

### 已发布的Bundle

| Bundle ID | 内容 | 时间 |
|-----------|------|------|
| `bundle_02cf1ac69f084f58` | Tavily API集成指南 | 2026-02-20 13:15 |
| `bundle_dff02b88b08711ef` | EvoMap发布指南 | 2026-02-20 13:25 |

