---
name: "plan"
description: "进入规划模式 - 分析现状、设计方案、等待确认后再执行"
argument-hint: <问题/任务描述>
---

# Plan 指令 — 通用规划模式

> 类似 Cloud Code 的 Plan Mode：从"写代码前规划"升级为"任何复杂任务前的规划澄清"

**核心理念**：先想透，再做稳，记下来。

---

## 功能

1. **现状分析** - 收集信息，理解当前状况
2. **需求澄清** - 明确要做什么，不做什么
3. **方案设计** - 提出可行的解决方案
4. **风险评估** - 识别潜在问题和阻碍
5. **等待确认** - 必须收到用户批准才执行

---

## 使用场景

| 类型 | 场景示例 |
|------|----------|
| **代码任务** | 新功能、重构、多文件修改、架构调整 |
| **决策问题** | 技术选型、方案对比、采购决策 |
| **流程设计** | SOP制定、工作流优化、体系建设 |
| **问题排查** | 系统性调试、根因分析、解决方案设计 |
| **学习任务** | 技能学习路径、知识体系构建 |
| **沟通规划** | 向上汇报、跨部门协调、冲突处理 |

---

## 工作流程

```
输入 /plan
    ↓
1. 收集信息 - 读相关文件、分析现状
    ↓
2. 澄清需求 - 问清楚要解决什么问题
    ↓
3. 设计方案 - 提出方案A/B/C，说明优劣
    ↓
4. 评估风险 - 列出潜在问题和应对
    ↓
5. 等待确认 - 用户说"执行"才开始
```

---

## 输出格式

```markdown
# 规划：[问题/任务标题]

## 📊 现状分析
- 当前情况：[描述]
- 已有资源：[列出]
- 关键约束：[列出]

## 🎯 需求澄清
- 核心诉求：[一句话]
- 成功标准：[可验证的标准]
- 不做什么：[明确边界]

## 💡 方案设计

### 方案A：[名称]
- 思路：[简述]
- 优势：[列出]
- 劣势：[列出]
- 预期结果：[描述]

### 方案B：[名称]
[同上]

### 方案C：[名称]
[同上]

**推荐**：方案 [X] - [理由]

## ⚠️ 风险评估
| 风险 | 严重程度 | 应对措施 |
|------|----------|----------|
| [风险1] | 高/中/低 | [应对] |
| [风险2] | 高/中/低 | [应对] |

## 📋 执行步骤
1. [步骤1]
2. [步骤2]
3. [步骤3]

---

**等待确认**：执行哪个方案？或需要调整？
```

---

## 使用示例

### 示例1：代码任务

```
用户: /plan 添加用户认证功能

# 规划：添加用户认证功能

## 📊 现状分析
- 当前：无认证，任何人可访问
- 技术栈：Next.js + Supabase
- 约束：需要支持邮箱登录和Google OAuth

## 🎯 需求澄清
- 核心诉求：保护敏感页面，只有登录用户可访问
- 成功标准：未登录跳转登录页，登录后可访问
- 不做什么：暂不做权限分级（管理员/普通用户）

## 💡 方案设计

### 方案A：Supabase Auth + Middleware
- 思路：用Supabase内置Auth，Next.js Middleware保护路由
- 优势：快速实现，无需维护密码
- 劣势：依赖Supabase
- 预期结果：1-2天完成

### 方案B：自建认证系统
- 思路：自己实现用户表、密码hash、session管理
- 优势：完全可控
- 劣势：开发周期长，安全性需自己保证
- 预期结果：3-5天完成

**推荐**：方案A - 速度和安全性更优

## ⚠️ 风险评估
| 风险 | 严重程度 | 应对措施 |
|------|----------|----------|
| Google OAuth配置复杂 | 中 | 留出半天时间研究 |
| Session过期处理 | 低 | 使用Supabase自动刷新 |

## 📋 执行步骤
1. 配置Supabase Auth Provider（Email + Google）
2. 创建登录页面（/login）
3. 添加Middleware保护路由
4. 实现登录状态检查
5. 测试登录/登出流程

---

**等待确认**：执行方案A？
```

### 示例2：非代码任务

```
用户: /plan 向老板汇报供应商管理优化成果

# 规划：供应商管理优化成果汇报

## 📊 现状分析
- 优化前：35家供应商，无体系化管理
- 优化后：建立五大支柱、16项KPI、全生命周期管理
- 关键成果：清退4家高风险，引入8家激活竞争
- 约束：老板时间有限，需要5分钟内讲清楚价值

## 🎯 需求澄清
- 核心诉求：让老板看到P7工作的价值，不是流水账
- 成功标准：老板记住1-2个关键成果，认可体系化思路
- 不做什么：不罗列所有细节，聚焦关键成果

## 💡 方案设计

### 方案A：问题-行动-结果结构
- 思路：STAR框架，讲清楚"什么问题→怎么做→什么结果"
- 优势：逻辑清晰，容易理解
- 劣势：可能显得常规
- 预期结果：5分钟，3个案例

### 方案B：数据对比+价值故事
- 思路：用前后对比数据，讲一个"从救火到防火"的故事
- 优势：更有感染力，突出思维方式转变
- 劣势：需要更强的表达技巧
- 预期结果：5分钟，1个核心故事

**推荐**：方案B - 更符合"体系构建者"的P7定位

## ⚠️ 风险评估
| 风险 | 严重程度 | 应对措施 |
|------|----------|----------|
| 数据太多讲不完 | 中 | 准备2个版本（5分钟/10分钟） |
| 老板追问细节 | 低 | 准备详细数据备份 |

## 📋 执行步骤
1. 整理前后对比数据
2. 写好"从救火到防火"故事线
3. 准备PPT（3页：问题→方案→结果）
4. 排练2遍，控制时间
5. 准备备用数据（应对追问）

---

**等待确认**：执行方案B？
```

---

## 与其他指令配合

| 指令 | 作用 |
|------|------|
| `/checklist` | 执行计划时逐项核实 |
| `/observer` | 观察对话过程，记录洞察 |
| `/learn` | 完成后固化经验 |

---

## 重要说明

**关键原则**：
- 不写代码，不执行操作，只规划
- 等待明确确认（"执行"、"开始"、"go"等）才开始
- 不确定时主动问，不假设答案
- 复杂任务必用，简单任务可选

---

*最后更新：2026-02-22 — 升级为通用规划模式*
