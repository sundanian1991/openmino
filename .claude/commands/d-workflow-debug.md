---
name: "workflow:debug"
description: "问题排查全流程 - 从发现问题到根因解决的结构化调试"
argument-hint: <问题描述>
---

# Workflow: 问题排查

> 半自动化全流程方案 - 发现→定位→调试→修复→验证

**核心理念**：让问题排查不再靠运气，而是有章可循的系统流程。

---

## 工作流程

```
问题描述 → 信息收集 → 根因分析 → 修复方案 → 测试验证 → 复盘记录
   ↓          ↓          ↓          ↓          ↓          ↓
  clarify  systematic-  debugging-  tdd-      testing-   docs-
            debugging   analysis   strict     patterns   writer
```

---

## 执行步骤

### 阶段1：问题描述（2分钟）
**调用**：系统引导

**输出**：
- 问题定义：具体是什么问题
- 复现步骤：如何触发问题
- 期望行为：应该是什么样
- 实际行为：现在是什么样

**交互**：
- 我问你问题
- 你提供详细信息
- 整理成问题报告

---

### 阶段2：信息收集（5分钟）
**调用**：`systematic-debugging`

**输出**：
- 日志信息：错误日志、console输出
- 环境信息：系统版本、配置
- 代码位置：问题可能在哪

**交互**：
- 我分析代码
- 检查日志
- 定位可疑区域

---

### 阶段3：根因分析（10分钟）
**调用**：`systematic-debugging` + 深度分析

**输出**：
- 根本原因：为什么会出现
- 影响范围：还影响什么
- 优先级：紧急/重要/一般

**交互**：
- 我提出假设
- 验证假设
- 确定根因

---

### 阶段4：修复方案（5分钟）
**调用**：`brainstorming` / `tdd-strict`

**输出**：
- 修复方案：具体怎么做
- 风险评估：可能的影响
- 回滚计划：出问题怎么办

**交互**：
- 我提出修复方案
- 你确认或调整
- 确定行动计划

---

### 阶段5：测试验证（10分钟）
**调用**：`tdd-strict` / `testing-patterns` / `webapp-testing`

**输出**：
- 测试用例：覆盖问题场景
- 修复代码：解决问题
- 验证结果：确认有效

**交互**：
- 我先写测试（TDD）
- 然后修复代码
- 运行测试验证

---

### 阶段6：复盘记录（5分钟）
**调用**：`docs-writer` / `checklist`

**输出**：
- 问题记录：问题、原因、方案
- 经验总结：下次怎么避免
- 更新文档：相关文档更新

**交互**：
- 我整理问题记录
- 提炼经验教训
- 更新错题本/文档

---

## 总耗时

| 阶段 | 预计耗时 |
|------|---------|
| 问题描述 | 2分钟 |
| 信息收集 | 5分钟 |
| 根因分析 | 10分钟 |
| 修复方案 | 5分钟 |
| 测试验证 | 10分钟 |
| 复盘记录 | 5分钟 |
| **总计** | **37分钟** |

---

## 使用示例

```
用户: /workflow:debug 用户列表页面加载很慢

AI: 让我们开始问题排查流程。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
❓ 阶段1：问题描述
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

我需要了解：

1. **具体表现**：
   - 加载时间是多少？（3秒？10秒？30秒？）
   - 是一直慢还是特定条件下慢？
   - 所有用户都慢还是部分用户？

2. **复现步骤**：
   - 访问哪个URL？
   - 需要登录吗？
   - 特定数据量时出现？

3. **最近变更**：
   - 最近有部署吗？
   - 有改动相关代码吗？
   - 数据量有变化吗？

用户: 加载15秒+，最近用户量从1000涨到5000

AI: 明白了。数据量增长5倍，加载慢很可能是数据查询问题。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔍 阶段2：信息收集
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[调用 systematic-debugging]

正在分析代码...
- 找到用户列表查询：src/api/users.ts
- 发现问题：没有分页，一次加载5000条
- 检查索引：user表created_at有索引

信息收集结论：
✓ 问题定位：用户列表查询无分页
✓ 数据量：5000条用户记录
✓ 查询方式：SELECT * FROM users ORDER BY created_at

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔬 阶段3：根因分析
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

根因分析：
1. **直接原因**：一次性加载5000条数据
2. **根本原因**：设计时没考虑分页（用户量少时没问题）
3. **影响范围**：用户列表页、所有依赖该API的页面

优先级：🔴 高 - 影响核心功能，用户体验差

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
💡 阶段4：修复方案
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[调用 tdd-strict]

修复方案：
1. 前端：添加分页组件，每页20条
2. 后端：API支持分页参数（page, limit）
3. 缓存：Redis缓存热门查询

风险评估：
- 需要改前后端代码
- 需要数据库迁移（可选）
- 回滚方案：保留原API，新增分页API

你确认这个方案吗？

[继续...]
```

---

## 涉及 Skills

| 阶段 | 主要 Skills |
|------|------------|
| 问题描述 | 系统引导 |
| 信息收集 | systematic-debugging |
| 根因分析 | systematic-debugging |
| 修复方案 | brainstorming, tdd-strict |
| 测试验证 | tdd-strict, testing-patterns, webapp-testing |
| 复盘记录 | docs-writer, checklist |

---

## 问题分类

| 类型 | 特点 | 常见原因 |
|------|------|----------|
| **性能问题** | 慢、卡顿 | 数据量、查询、渲染 |
| **功能问题** | 不工作、报错 | 逻辑错误、边界条件 |
| **兼容问题** | 部分环境不行 | 浏览器、版本、配置 |
| **数据问题** | 数据不对 | 输入错误、迁移失败 |

---

## 输出物

| 阶段 | 输出 |
|------|------|
| 问题描述 | 问题报告 |
| 信息收集 | 可疑区域清单 |
| 根因分析 | 根因分析报告 |
| 修复方案 | 修复方案文档 |
| 测试验证 | 测试用例+修复代码 |
| 复盘记录 | 问题记录+经验总结 |

---

## 重要说明

**适用场景**：
- 代码bug
- 性能问题
- 功能异常
- 兼容性问题

**核心原则**：
- 先定位根因，再动手修复
- TDD：先写测试，再写代码
- 必须验证：修复后要确认有效
- 记录经验：避免重复踩坑

---

*最后更新：2026-02-22 — 问题排查工作流*
