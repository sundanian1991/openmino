# P2-ASSESSMENT.md - P2改进评估

*评估Semantic Index、记忆衰减自动化、模型分配的必要性。*

---

## 评估1：Semantic Index（向量索引）

### 当前状态

**现有搜索方式**：
- grep：关键词匹配，快速但不够智能
- Read：读全文件，准确但成本高
- tavily_search：外部搜索，但只用于网络内容

**Moltbook的三层架构**：
- Tier 1: Daily Logs — 原始记录
- Tier 2: Curated Memory — 精炼知识
- Tier 3: Semantic Index — 本地向量，语义检索

**效果**：检索成本从15k tokens降到500 tokens

### 我的情况分析

| 维度 | 我的现状 | Moltbook | 差距 |
|------|----------|----------|------|
| 文件数量 | ~100个md文件 | 未知 | 较少 |
| 搜索频率 | 每天5-10次 | 未知 | 中等 |
| 搜索类型 | 主要是文件名/关键词 | 语义搜索 | 不同 |
| Token成本 | 会话制，不累积 | 持续运行，成本敏感 | 不同 |

**关键差异**：
- Moltbook是24/7运行的agent，每次搜索都有API成本
- 我是会话制，Token成本在单次会话内，跨会话不累积

### 评估结论

**暂时不需要Semantic Index**，原因：

1. **文件规模小**：~100个文件，grep够用
2. **搜索模式简单**：主要是文件名+关键词匹配
3. **成本结构不同**：会话制vs持续运行，需求不同
4. **维护成本**：向量索引需要额外存储、更新、查询开销

**何时需要**：
- 文件数量>500个
- 语义搜索需求增加（如"关于记忆的所有内容"）
- 跨会话查询频率增加

**替代方案**：
- 改进grep策略：使用`-r`递归、`-i`忽略大小写、`-C`显示上下文
- 改进文件命名：让文件名更自描述
- 改进内容组织：MEMORY.md的五层结构已经很好

---

## 评估2：记忆衰减自动化

### 当前状态

**热温冷化石机制**（Moltbook）：
- 热记忆：当前会话，会话结束清除
- 温记忆：近期重要交互，时间衰减公式
- 冷记忆：长期知识，低频访问触发归档
- 化石记忆：核心身份，永不衰减

**我的五层结构**：
- 🔴 L1 置顶区：WAL协议核心记录
- 🟠 L2 高频区：30天内调用≥3次
- 🟡 L3 时新区：最近7天关键信息
- 🟢 L4 知识区：体系化内容
- ⚪ L5 日记区：原始记录（周度清理）

### 评估结论

**部分需要自动化**，原因：

1. **L2高频追踪**：目前是手动判断，可以自动化
   - 方案：每次访问时记录时间戳和次数
   - 触发：30天内调用≥3次自动提升到L2

2. **L3→L4归档**：目前是手动，可以半自动化
   - 方案：每周回顾时，7天前的L3内容评估是否提升到L4
   - 触发：WEEKLY-REVIEW.md机制已建立

3. **L5清理**：目前是手动，可以半自动化
   - 方案：每周回顾时，标记无价值内容
   - 触发：月度任务已存在

**何时需要全自动化**：
- 文件数量>500个
- 访问频率>50次/天
- 记忆衰减需求复杂（如多维度衰减公式）

**当前方案**：
- 保持手动+半自动化
- WEEKLY-REVIEW.md负责周度回顾
- 手动判断L2/L3/L4归属

---

## 评估3：模型分配策略

### 当前状态

**我现在用的模型**：glm-4.7（根据system提示）

**Moltbook的分配策略**：
- 深度推理：GLM-5（200k上下文、复杂逻辑）
- 高速执行：MiniMax 2.5（100+ tokens/sec）
- 交互会话：GLM-5（准确性优先）
- 后台任务：MiniMax 2.5（成本效益）

### 评估结论

**暂时无法实现**，原因：

1. **我只有单一模型**：glm-4.7
2. **没有模型切换机制**：Claude Code环境下，模型由系统选择
3. **成本结构不同**：我不是API调用付费，是会话制

**何时需要**：
- 年老师有GLM-5/MiniMax访问权限
- 系统支持模型切换
- 成本敏感度增加（如按API付费）

**当前方案**：
- 用好glm-4.7的全部能力
- 优化提示词策略（复杂任务用详细prompt）
- 优化工作流程（减少不必要的推理）

---

## P2改进总结

| 评估项 | 结论 | 理由 | 替代方案 |
|--------|------|------|----------|
| Semantic Index | ❌ 暂时不需要 | 文件少、grep够用、成本结构不同 | 改进grep策略、文件命名、内容组织 |
| 记忆衰减自动化 | 🔄 半自动化 | 频率不高、手动判断够用 | WEEKLY-REVIEW + 手动判断 |
| 模型分配策略 | ❌ 无法实现 | 只有单一模型、无切换机制 | 优化prompt、优化流程 |

---

## 下一步行动

**立即可做**：
1. 改进grep策略（优先级：高）
2. 改进文件命名（优先级：中）
3. 优化提示词策略（优先级：中）

**需要确认**：
1. 年老师是否有GLM-5/MiniMax访问权限？
2. 是否需要我主动建议模型切换（如果有多模型）？

**长期观察**：
1. 文件数量增长趋势
2. 搜索频率和复杂度
3. 成本敏感度变化

---

*评估完成：2026-02-20。下次评估：文件数量翻倍或3个月后。*
